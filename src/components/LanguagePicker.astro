---
import { languages } from '../i18n/ui';

const { currentLang = 'th' } = Astro.props;
---
<div class="flex items-center bg-gray-100 rounded-full p-1 border border-gray-200 shadow-inner">
  {Object.entries(languages).map(([lang, label]) => {
    let href = Astro.url.pathname;
    
    if (currentLang === 'en' && lang === 'th') {
      href = href.replace(/^\/en/, '') || '/';
    } else if (currentLang === 'th' && lang === 'en') {
      href = `/en${href === '/' ? '' : href}`;
    } else if (currentLang === lang) {
        href = '#'; // Current language, stay here (or use current path)
    }

    // Flag URLs
    const flagUrl = lang === 'th' 
        ? 'https://flagcdn.com/w80/th.png' 
        : 'https://flagcdn.com/w80/gb.png';

    const isActive = currentLang === lang;

    return (
      <a
        href={href}
        class:list={[
            "flex items-center justify-center w-9 h-9 rounded-full transition-all duration-200 focus:outline-none focus:ring-2 focus:ring-royal-500",
            isActive ? "bg-white shadow-sm scale-105 z-10" : "hover:bg-gray-200 opacity-60 hover:opacity-100 grayscale hover:grayscale-0"
        ]}
        aria-label={`Switch to ${label}`}
        aria-current={isActive ? 'page' : undefined}
      >
        <img 
            src={flagUrl} 
            width="24" 
            height="24" 
            alt={label} 
            class="w-6 h-6 rounded-full object-cover border border-gray-100"
            loading="eager"
        />
      </a>
    );
  })}
</div>
